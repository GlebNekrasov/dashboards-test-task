import{d as R,r as v,c as h,a as y,s as x,b as w,e as g,u as c,i as C,B as $,f as F,g as z,o as f,_ as b,h as S,j as B,k as T,l as L}from"./index-CJeviEfv.js";import{r as N,a as O,D as q,b as D,T as M,C as P,c as E,L as A,B as K,p as W,e as j,f as U,h as V}from"./index-BSJIu_te.js";function G(d){return N({url:"/stocks",method:"get",params:d})}const I=R("stocks",()=>{const d=v(!1),n=v(new Date().toISOString().split("T")[0]),o=v(0),r=v([]),i=h(()=>r.value.filter(u=>!(t.value.length>0&&!t.value.includes(u.category)||a.value.length>0&&!a.value.includes(u.warehouse_name)))),t=v([]),a=v([]),e=h(()=>{const u=r.value.filter(s=>!(t.value.length>0&&!t.value.includes(s.category)));return[...new Set(u.map(s=>s.warehouse_name))]}),_=h(()=>{const u=r.value.filter(s=>!(a.value.length>0&&!a.value.includes(s.warehouse_name)));return[...new Set(u.map(s=>s.category))]});function l(){r.value=[],t.value=[],a.value=[],o.value=0}async function m(u=1,s=500){const p=await G({dateFrom:n.value,page:u,limit:s});return{data:p.data,meta:p.meta}}async function k(){let u=!1,s=1;for(r.value=[],o.value=0,n.value=new Date().toISOString().split("T")[0];!u;)try{d.value=!0;const p=await m(s);o.value=p.meta.total,r.value.push(...p.data),s===p.meta.last_page&&(u=!0),s++}catch{O.error({message:"Не получилось загрузить данные об остатках"}),l()}finally{d.value=!1}}return k(),{dateFrom:n,filteredStocksData:i,foundRecordsCount:o,isLoading:d,categoryOptions:_,stocksData:r,selectedCategories:t,selectedWarehouseNames:a,warehouseNameOptions:e,getStocksData:k}}),H={class:"stocks-filters"},J=y({__name:"StocksFilters",setup(d){const n=I(),{dateFrom:o,stocksData:r,selectedWarehouseNames:i,selectedCategories:t,warehouseNameOptions:a,categoryOptions:e,isLoading:_}=x(n),l=h(()=>r.value.length===0||_.value),m=h(()=>i.value.length>0||t.value.length>0);function k(){i.value=[],t.value=[]}return(u,s)=>(f(),w("div",H,[g(q,{"date-text":c(o),title:"Дата",disabled:""},null,8,["date-text"]),g(D,{value:c(i),"onUpdate:value":s[0]||(s[0]=p=>C(i)?i.value=p:null),disabled:l.value,options:c(a),title:"Склад",width:300},null,8,["value","disabled","options"]),g(D,{value:c(t),"onUpdate:value":s[1]||(s[1]=p=>C(t)?t.value=p:null),disabled:l.value,options:c(e),title:"Категория",width:300},null,8,["value","disabled","options"]),g(c($),{disabled:!m.value||c(_),type:"primary",onClick:k},{default:F(()=>[...s[2]||(s[2]=[z(" Очистить фильтры ",-1)])]),_:1},8,["disabled"])]))}}),Q=b(J,[["__scopeId","data-v-a846785a"]]),X={class:"stocks-table"},Y=y({__name:"StocksTable",setup(d){const n=I(),{filteredStocksData:o,isLoading:r}=x(n),i=[{title:"NM ID",dataIndex:"nm_id",key:"nm_id",width:100,fixed:"left"},{title:"Дата",dataIndex:"date",key:"date",width:100},{title:"Артикул поставщика",dataIndex:"supplier_article",key:"supplier_article",width:150},{title:"Размер",dataIndex:"tech_size",key:"tech_size",width:150},{title:"Штрихкод",dataIndex:"barcode",key:"barcode",width:100},{title:"Количество",dataIndex:"quantity",key:"quantity",width:100},{title:"Полное количество",dataIndex:"quantity_full",key:"quantity_full",width:100},{title:"В пути к клиенту",dataIndex:"in_way_to_client",key:"in_way_to_client",width:100},{title:"В пути от клиента",dataIndex:"in_way_from_client",key:"in_way_from_client",width:100},{title:"Склад",dataIndex:"warehouse_name",key:"warehouse_name",width:200},{title:"Категория",dataIndex:"category",key:"category",width:150},{title:"Предмет",dataIndex:"subject",key:"subject",width:150},{title:"Бренд",dataIndex:"brand",key:"brand",width:150},{title:"Код SC",dataIndex:"sc_code",key:"sc_code",width:100},{title:"Цена",dataIndex:"price",key:"price",width:100,customRender:({value:e})=>e?parseFloat(e).toFixed(2):""},{title:"Скидка",dataIndex:"discount",key:"discount",width:100,customRender:({value:e})=>e?parseFloat(e).toFixed(2):""},{title:"Поставка",dataIndex:"is_supply",key:"is_supply",width:80,customRender:({value:e})=>e?"Да":"Нет"},{title:"Реализация",dataIndex:"is_realization",key:"is_realization",width:100,customRender:({value:e})=>e?"Да":"Нет"},{title:"Последнее изменение",dataIndex:"last_change_date",key:"last_change_date",width:100}];function t(e){return`${e.nm_id}-${e.barcode}-${e.sc_code}-${e.warehouse_name}`}function a(e){return`Всего строк в таблице: ${e}`}return(e,_)=>(f(),w("div",X,[c(o).length>0?(f(),S(c(M),{key:0,dataSource:c(o),columns:i,loading:c(r),rowKey:l=>t(l),scroll:{x:"max-content"},size:"small",sticky:"",pagination:{pageSize:50,showTotal:l=>a(l),position:["topRight"],showSizeChanger:!1}},null,8,["dataSource","loading","rowKey","pagination"])):B("",!0)]))}}),Z=b(Y,[["__scopeId","data-v-0a7a8390"]]),ee=y({__name:"SingleBarChart",props:{dataLables:{},data:{},barsColor:{default:"#C4193E"},responsive:{type:Boolean,default:!0},title:{}},setup(d){const n=d;P.register(E,A,K,W,j,U);const o=h(()=>{const _=n.dataLables.map((l,m)=>({label:l,value:n.data[m]??0}));return _.sort((l,m)=>l.label.localeCompare(m.label)),{labels:_.map(l=>l.label),values:_.map(l=>l.value)}}),r=h(()=>({labels:o.value.labels,datasets:[{data:o.value.values,borderColor:n.barsColor,backgroundColor:n.barsColor}]})),i=h(()=>({responsive:n.responsive,plugins:{legend:{display:!1},title:{display:!0,text:n.title}},scales:{x:{ticks:{maxRotation:90,minRotation:90}}}})),t=v(null),a=v(0);let e=null;return T(()=>{t.value&&(e=new ResizeObserver(()=>{a.value++}),e.observe(t.value))}),L(()=>{e&&e.disconnect()}),(_,l)=>(f(),w("div",{ref_key:"chartContainer",ref:t,class:"single-bar-chart-wrapper"},[(f(),S(c(V),{key:a.value,class:"single-bar-chart",data:r.value,options:i.value},null,8,["data","options"]))],512))}}),te=b(ee,[["__scopeId","data-v-d16f95c3"]]),ae={class:"stocks-warehouses-chart"},se=y({__name:"StocksWarehousesBarChart",setup(d){const n=I(),{filteredStocksData:o}=x(n),r=h(()=>{const t=new Map;return o.value.forEach(a=>{const e=t.get(a.warehouse_name)||0;t.set(a.warehouse_name,e+a.quantity)}),Array.from(t.keys())}),i=h(()=>{const t=new Map;return o.value.forEach(a=>{const e=t.get(a.warehouse_name)||0;t.set(a.warehouse_name,e+a.quantity)}),Array.from(t.values())});return(t,a)=>(f(),w("div",ae,[c(o).length>0?(f(),S(te,{data:i.value,"data-lables":r.value,title:"Количество остатков по складам",key:"bar1"},null,8,["data","data-lables"])):B("",!0)]))}}),ne={class:"stocks-page"},oe=y({__name:"StocksPage",setup(d){return(n,o)=>(f(),w("div",ne,[g(Q,{class:"stocks-page__filters"}),g(se,{class:"stocks-page__chart"}),g(Z,{class:"stocks-page__table"})]))}}),ie=b(oe,[["__scopeId","data-v-0ec21b11"]]);export{ie as default};
